@model Projeto_TCC_2022.Models.Orçamento

<div id="Div" class="card mx-auto">
    <div class="card-header">
        <i class="bi bi-clipboard2-fill me-2"></i> Orçamento:
    </div>
    <div class="card-body">
        @if (Model.Status == 11) //Recusado pela Oficina
        {
            <h2 class="text-center">Pedido recusado pela Oficina.</h2>
            <i class="bi bi-x-circle-fill" style="color: darkred"></i>
        }

        @if (Model.Status == 12 && ViewBag.éPessoa == true) //Aceito pela Oficina, aguardando formulação do orçamento
        {
            <h2 class="text-center">Aceito pela Oficina, aguardando formulação do Orçamento.</h2>
        }

        @if (Model.Status == 22 && ViewBag.éPessoa == true) // Em Formulação
        {
            <h2 class="text-center">Em Formulação</h2>
        }

        @if (Model.Status == 23 && ViewBag.éPessoa == true) //Aguardando Aprovação Cliente
        {
            using (Html.BeginForm("AprovarOrçamento", "Orçamento", FormMethod.Post))
            {
                <input name="Id" id="Id" value="@Model.Id" type="hidden" class="d-none" />

                <div class="row text-center">
                    <div class="col-md-6 col-sm-12">
                        <button type="submit" class="btn btn-success" value="32" name="Operação">Aceitar</button>
                    </div>
                    <div class="col-md-6 col-sm-12">
                        <button type="submit" class="btn btn-danger" value="31" name="Operação">
                            Recusar
                        </button>
                    </div>
                </div>
            }
        }

        @if (Model.Status == 23 && ViewBag.éOficina == true) //Aguardando Aprovação Cliente
        {
            <h2 class="text-center">Aguardando aprovação do cliente...</h2>
        }

        @if (Model.Status == 24) //Cliente nunca levou o carro
        {
            <h2 class="text-center">Finalizado. Cliente nunca levou o veículo para ser analisado.</h2>
            <i class="bi bi-exclamation-circle-fill" style="color:darkred"></i>
        }

        @if (Model.Status == 32) //Finalizado com sucesso
        {
            <h2 class="text-center">Finalizado com sucesso.</h2>
            <i class="bi bi-check-circle-fill" style="color:green"></i>
        }

        @if (Model.Status == 31) //Reprovado pelo Cliente
        {
            <h2 class="text-center">Finalizado. Orçamento reprovado pelo Cliente.</h2>
            <i class="bi bi-x-circle-fill" style="color: darkred"></i>
        }
    </div>
</div>
<div id="Status">

</div>


@if (Model.Status != 32)
{
    <div class="text-center mt-3">
        <a href="@Url.Action("HistoricoOrçamento", "Orçamento")">Retornar</a>
    </div>

}

<div class="row mt-3 text-center">
    <div class="col-md-3 offset-md-2">

    </div>
    <a href="@Url.Action("HistoricoOrçamento", "Orçamento")">Retornar</a>
</div>

@if (Model.Status == 32 && ViewBag.éPessoa == true)
{
    <div class="row mt-3 text-center">
        <div class="col-md-4 offset-md-2">
            <a href="@Url.Action("HistoricoOrçamento", "Orçamento")">Retornar</a>
        </div>
        <div class="col-md-4 offset-md-2">
            <a href="">Avaliar Serviços</a>
        </div>
    </div>
}


@section scripts{

    @if (Model.Status == 10)
    {
        <script>

            function Update() {
                $.ajax
                ({
                    type: 'GET',
                    url: '@Url.Action("OficinaApprovePartial", "Orçamento", new { Id = Model.Id })',
                    dataType: 'html',
                    cache: false,
                    success: function (data) {
                        $('#Div').html(data);
                    },
                    error: function () {
                        console.log("Erro");
                    }
                });
            };

            function exibir() {

                if ($("#Horário1").is(":checked")) {
                    $("#tempo").addClass("d-none");
                    $("#tempo").removeAttr("data-val");
                }
                else if ($("#Horário2").is(":checked")) {
                    $("#tempo").removeClass("d-none");
                    $("#tempo").addAttr("data-val");

                    var attrCNPJ = $("#tempo").attr("data-val");

                    if (typeof attrCNPJ !== undefined) {
                        $("#CNPJ").attr("data-val", true);
                    }
                }
            }

        </script>
    }

    @if (Model.Status == 21)
    {
        <script>
            function Update() {
                $.ajax({

                    type: 'GET',
                    url: '@Url.Action("ConfirmarAvaliaçãoPartial", "Orçamento", new { Id = Model.Id })',
                    dataType: 'html',
                    cache: false,
                    success: function (data) {
                        $('#Div').html(data);
                    },
                    error: function () {
                        console.log("Erro");
                    }
                });
            };
        </script>
    }

    @if (Model.Status == 12 && ViewBag.éOficina == true || Model.Status == 22 && ViewBag.éOficina == true)
    {
        <script>
            function Update() {
                $.ajax
                ({
                    type: 'GET',
                    url: '@Url.Action("FormularPromptPartial", "Orçamento", new { Id = Model.Id })',
                    dataType: 'html',
                    cache: false,
                    success: function (data) {
                        $('#Div').html(data);
                    },
                    error: function () {
                        console.log("Erro");
                    }
                });
            };
        </script>
    }

    <script>

        function Lista() {
            $.ajax({

                type: 'GET',
                url: '@Url.Action("DetalhesOrçamentoPartial", "Orçamento", new {Id = Model.Id})',
                dataType: 'html',
                cache: false,
                success: function (data) {
                    $('#Status').html(data);
                },
                error: function () {
                    console.log("Detalhes Ajax Erro");
                }
            })
        }

        $(document).ready(function () {
            @if (Model.Status != 10 && Model.Status != 24 && Model.Status != 32 && Model.Status != 31) {
                <text>
                    setInterval(function() {
                        Update();
                        Lista();
                    }, 20000);
                    Update();
                </text>
            }
            Lista();
        });
    </script>
}
